name: Deploy HMS Application

on:
  push:
    branches-ignore:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 20

    - name: Install dependencies
      run: |
        cd HMS
        npm install

    - name: Build HMS application
      run: |
        cd HMS
        npm run build

    - name: Delete branch after success
      if: success()
      run: |
        BRANCH_NAME=$(echo "${GITHUB_REF#refs/heads/}")
        if [ "$BRANCH_NAME" != "main" ]; then
          git push origin --delete "$BRANCH_NAME"
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}